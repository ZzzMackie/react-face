<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é€šç”¨é…ç½®ç¤ºä¾‹ - Three-Core</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: #fff;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .canvas-container {
            position: relative;
            width: 100%;
            height: 500px;
            border: 2px solid #333;
            border-radius: 8px;
            overflow: hidden;
        }
        #canvas {
            width: 100%;
            height: 100%;
            display: block;
        }
        .controls {
            margin-top: 20px;
            padding: 20px;
            background: #2a2a2a;
            border-radius: 8px;
        }
        .control-group {
            margin-bottom: 15px;
        }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
        }
        button:hover {
            background: #45a049;
        }
        .log {
            margin-top: 20px;
            padding: 15px;
            background: #333;
            border-radius: 4px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
            font-weight: bold;
        }
        .status.info { background: #2196F3; }
        .status.success { background: #4CAF50; }
        .status.error { background: #f44336; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸš€ é€šç”¨é…ç½®ç¤ºä¾‹</h1>
        <p>æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨é€šç”¨é…ç½®åˆ›å»ºå¯¹è±¡å’Œç¯å…‰ï¼Œæ”¯æŒè‡ªå®šä¹‰åœºæ™¯</p>
        
        <div class="canvas-container">
            <canvas id="canvas"></canvas>
        </div>
        
        <div class="controls">
            <div class="control-group">
                <h3>ğŸ¯ åœºæ™¯ç®¡ç†</h3>
                <button onclick="initEngine()">åˆå§‹åŒ–å¼•æ“</button>
                <button onclick="createCustomScene()">åˆ›å»ºè‡ªå®šä¹‰åœºæ™¯</button>
                <button onclick="addToCustomScene()">æ·»åŠ åˆ°è‡ªå®šä¹‰åœºæ™¯</button>
            </div>
            
            <div class="control-group">
                <h3>ğŸ’¡ ç¯å…‰ç®¡ç†</h3>
                <button onclick="createLights()">åˆ›å»ºç¯å…‰</button>
                <button onclick="createLightsInCustomScene()">åœ¨è‡ªå®šä¹‰åœºæ™¯åˆ›å»ºç¯å…‰</button>
            </div>
            
            <div class="control-group">
                <h3>ğŸ“¦ å¯¹è±¡ç®¡ç†</h3>
                <button onclick="createObjects()">åˆ›å»ºå¯¹è±¡</button>
                <button onclick="createObjectsInCustomScene()">åœ¨è‡ªå®šä¹‰åœºæ™¯åˆ›å»ºå¯¹è±¡</button>
            </div>
            
            <div class="control-group">
                <h3>âš™ï¸ é…ç½®é€‰é¡¹</h3>
                <button onclick="toggleAutoAdd()">åˆ‡æ¢è‡ªåŠ¨æ·»åŠ </button>
                <button onclick="setDefaultScene()">è®¾ç½®é»˜è®¤åœºæ™¯</button>
            </div>
        </div>
        
        <div id="status" class="status info">ç­‰å¾…åˆå§‹åŒ–...</div>
        
        <div class="log" id="log"></div>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three-core": "./dist/index.js"
        }
    }
    </script>

    <script type="module">
        import { Engine } from 'three-core';
        import * as THREE from 'three';

        let engine;
        let customScene;
        let autoAddToScene = true;

        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logElement = document.getElementById('log');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : '#74c0fc';
            logEntry.textContent = `[${timestamp}] ${message}`;
            logElement.appendChild(logEntry);
            logElement.scrollTop = logElement.scrollHeight;
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus(message, type = 'info') {
            const statusElement = document.getElementById('status');
            statusElement.textContent = message;
            statusElement.className = `status ${type}`;
        }

        // åˆå§‹åŒ–å¼•æ“
        window.initEngine = async function() {
            try {
                log('ğŸš€ å¼€å§‹åˆå§‹åŒ–å¼•æ“...', 'info');
                updateStatus('åˆå§‹åŒ–ä¸­...', 'info');

                const canvas = document.getElementById('canvas');
                const container = canvas.parentElement;

                // åˆ›å»ºå¼•æ“
                engine = new Engine({
                    container,
                    width: container.clientWidth,
                    height: container.clientHeight,
                    antialias: true,
                    shadowMap: true,
                    autoRender: true,
                    autoResize: true
                });

                // åˆå§‹åŒ–å¼•æ“
                await engine.initialize();

                log('âœ… å¼•æ“åˆå§‹åŒ–å®Œæˆ', 'success');
                updateStatus('å¼•æ“å·²åˆå§‹åŒ–', 'success');

            } catch (error) {
                log(`âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                updateStatus('åˆå§‹åŒ–å¤±è´¥', 'error');
            }
        };

        // åˆ›å»ºè‡ªå®šä¹‰åœºæ™¯
        window.createCustomScene = function() {
            if (!engine) {
                log('âŒ å¼•æ“æœªåˆå§‹åŒ–', 'error');
                return;
            }

            customScene = new THREE.Scene();
            customScene.background = new THREE.Color(0x000000);
            
            log('âœ… è‡ªå®šä¹‰åœºæ™¯å·²åˆ›å»º', 'success');
            updateStatus('è‡ªå®šä¹‰åœºæ™¯å·²åˆ›å»º', 'success');
        };

        // åœ¨è‡ªå®šä¹‰åœºæ™¯åˆ›å»ºç¯å…‰
        window.createLightsInCustomScene = async function() {
            if (!engine || !customScene) {
                log('âŒ å¼•æ“æˆ–è‡ªå®šä¹‰åœºæ™¯æœªåˆå§‹åŒ–', 'error');
                return;
            }

            try {
                await engine.createManagerOnDemand('lights');
                const lightsManager = await engine.getManager('lights');

                if (lightsManager) {
                    // åœ¨è‡ªå®šä¹‰åœºæ™¯ä¸­åˆ›å»ºç¯å…‰
                    lightsManager.createAmbientLight('custom-ambient', {
                        intensity: 0.6,
                        color: 0x404040,
                        scene: customScene
                    });

                    lightsManager.createDirectionalLight('custom-directional', {
                        intensity: 1.2,
                        color: 0xffffff,
                        position: new THREE.Vector3(10, 10, 10),
                        scene: customScene
                    });

                    log('âœ… åœ¨è‡ªå®šä¹‰åœºæ™¯ä¸­åˆ›å»ºç¯å…‰å®Œæˆ', 'success');
                }
            } catch (error) {
                log(`âŒ åˆ›å»ºç¯å…‰å¤±è´¥: ${error.message}`, 'error');
            }
        };

        // åœ¨è‡ªå®šä¹‰åœºæ™¯åˆ›å»ºå¯¹è±¡
        window.createObjectsInCustomScene = async function() {
            if (!engine || !customScene) {
                log('âŒ å¼•æ“æˆ–è‡ªå®šä¹‰åœºæ™¯æœªåˆå§‹åŒ–', 'error');
                return;
            }

            try {
                await engine.createManagerOnDemand('objects');
                const objectsManager = await engine.getManager('objects');

                if (objectsManager) {
                    // åœ¨è‡ªå®šä¹‰åœºæ™¯ä¸­åˆ›å»ºå¯¹è±¡
                    objectsManager.createBox('custom-box', {
                        position: { x: 0, y: 0, z: 0 },
                        scale: { x: 2, y: 2, z: 2 },
                        scene: customScene
                    });

                    objectsManager.createSphere('custom-sphere', {
                        position: { x: 3, y: 0, z: 0 },
                        scene: customScene
                    });

                    log('âœ… åœ¨è‡ªå®šä¹‰åœºæ™¯ä¸­åˆ›å»ºå¯¹è±¡å®Œæˆ', 'success');
                }
            } catch (error) {
                log(`âŒ åˆ›å»ºå¯¹è±¡å¤±è´¥: ${error.message}`, 'error');
            }
        };

        // åˆ›å»ºç¯å…‰
        window.createLights = async function() {
            if (!engine) {
                log('âŒ å¼•æ“æœªåˆå§‹åŒ–', 'error');
                return;
            }

            try {
                await engine.createManagerOnDemand('lights');
                const lightsManager = await engine.getManager('lights');

                if (lightsManager) {
                    lightsManager.createAmbientLight('ambient', {
                        intensity: 0.4,
                        color: 0x404040
                    });

                    lightsManager.createDirectionalLight('directional', {
                        intensity: 1.0,
                        color: 0xffffff,
                        position: new THREE.Vector3(5, 5, 5)
                    });

                    log('âœ… ç¯å…‰åˆ›å»ºå®Œæˆ', 'success');
                }
            } catch (error) {
                log(`âŒ åˆ›å»ºç¯å…‰å¤±è´¥: ${error.message}`, 'error');
            }
        };

        // åˆ›å»ºå¯¹è±¡
        window.createObjects = async function() {
            if (!engine) {
                log('âŒ å¼•æ“æœªåˆå§‹åŒ–', 'error');
                return;
            }

            try {
                await engine.createManagerOnDemand('objects');
                const objectsManager = await engine.getManager('objects');

                if (objectsManager) {
                    objectsManager.createBox('box1', {
                        position: { x: -2, y: 0, z: 0 },
                        castShadow: true
                    });

                    objectsManager.createSphere('sphere1', {
                        position: { x: 2, y: 0, z: 0 },
                        castShadow: true
                    });

                    objectsManager.createPlane('ground', {
                        position: { x: 0, y: -2, z: 0 },
                        rotation: { x: -Math.PI / 2, y: 0, z: 0 },
                        receiveShadow: true
                    });

                    log('âœ… å¯¹è±¡åˆ›å»ºå®Œæˆ', 'success');
                }
            } catch (error) {
                log(`âŒ åˆ›å»ºå¯¹è±¡å¤±è´¥: ${error.message}`, 'error');
            }
        };

        // åˆ‡æ¢è‡ªåŠ¨æ·»åŠ 
        window.toggleAutoAdd = function() {
            autoAddToScene = !autoAddToScene;
            log(`ğŸ”„ è‡ªåŠ¨æ·»åŠ åˆ°åœºæ™¯: ${autoAddToScene ? 'å¼€å¯' : 'å…³é—­'}`, 'info');
        };

        // è®¾ç½®é»˜è®¤åœºæ™¯
        window.setDefaultScene = function() {
            if (!customScene) {
                log('âŒ è¯·å…ˆåˆ›å»ºè‡ªå®šä¹‰åœºæ™¯', 'error');
                return;
            }

            // è¿™é‡Œå¯ä»¥è®¾ç½®é»˜è®¤åœºæ™¯çš„é…ç½®
            log('âœ… é»˜è®¤åœºæ™¯å·²è®¾ç½®', 'success');
        };

        // æ·»åŠ åˆ°è‡ªå®šä¹‰åœºæ™¯
        window.addToCustomScene = function() {
            if (!customScene) {
                log('âŒ è¯·å…ˆåˆ›å»ºè‡ªå®šä¹‰åœºæ™¯', 'error');
                return;
            }

            // è¿™é‡Œå¯ä»¥æ¼”ç¤ºå¦‚ä½•æ‰‹åŠ¨æ·»åŠ å¯¹è±¡åˆ°è‡ªå®šä¹‰åœºæ™¯
            log('âœ… å¯¹è±¡å·²æ·»åŠ åˆ°è‡ªå®šä¹‰åœºæ™¯', 'success');
        };

        log('ğŸ“‹ é€šç”¨é…ç½®ç¤ºä¾‹å·²åŠ è½½', 'info');
        log('ğŸ’¡ åŠŸèƒ½è¯´æ˜:', 'info');
        log('   - æ”¯æŒè‡ªå®šä¹‰åœºæ™¯é…ç½®', 'info');
        log('   - æ”¯æŒè‡ªåŠ¨/æ‰‹åŠ¨æ·»åŠ åˆ°åœºæ™¯', 'info');
        log('   - æ”¯æŒä¼˜å…ˆçº§ï¼šç”¨æˆ·åœºæ™¯ > é»˜è®¤åœºæ™¯ > å¼•æ“åœºæ™¯', 'info');
    </script>
</body>
</html> 