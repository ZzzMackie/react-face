<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Three-Core å¼•æ“æ¼”ç¤º</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #ffffff;
            overflow: hidden;
            height: 100vh;
        }

        .container {
            display: flex;
            height: 100vh;
        }

        .canvas-container {
            flex: 1;
            position: relative;
            background: #000;
        }

        #canvas {
            width: 100%;
            height: 100%;
            display: block;
        }

        .control-panel {
            width: 350px;
            background: #2a2a2a;
            border-left: 1px solid #444;
            display: flex;
            flex-direction: column;
            transition: transform 0.3s ease;
        }

        .control-panel.collapsed {
            transform: translateX(100%);
        }

        .panel-header {
            background: #333;
            padding: 15px;
            border-bottom: 1px solid #444;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .panel-title {
            font-size: 18px;
            font-weight: bold;
        }

        .toggle-btn {
            background: #555;
            border: none;
            color: white;
            padding: 8px 12px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .toggle-btn:hover {
            background: #666;
        }

        .panel-content {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
        }

        .section {
            margin-bottom: 20px;
            border: 1px solid #444;
            border-radius: 6px;
            overflow: hidden;
        }

        .section-header {
            background: #3a3a3a;
            padding: 10px 15px;
            cursor: pointer;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: bold;
        }

        .section-header:hover {
            background: #444;
        }

        .section-content {
            padding: 15px;
            display: none;
        }

        .section-content.active {
            display: block;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-size: 14px;
            color: #ccc;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 8px;
            border: 1px solid #555;
            border-radius: 4px;
            background: #333;
            color: white;
            font-size: 14px;
        }

        .form-group input:focus, .form-group select:focus {
            outline: none;
            border-color: #007acc;
        }

        .btn {
            background: #007acc;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 8px;
            margin-bottom: 8px;
        }

        .btn:hover {
            background: #005a9e;
        }

        .btn.danger {
            background: #dc3545;
        }

        .btn.danger:hover {
            background: #c82333;
        }

        .btn.success {
            background: #28a745;
        }

        .btn.success:hover {
            background: #218838;
        }

        .btn.warning {
            background: #ffc107;
            color: #212529;
        }

        .btn.warning:hover {
            background: #e0a800;
        }

        .object-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #555;
            border-radius: 4px;
            background: #333;
        }

        .object-item {
            padding: 8px 12px;
            border-bottom: 1px solid #555;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .object-item:last-child {
            border-bottom: none;
        }

        .object-item:hover {
            background: #444;
        }

        .object-name {
            font-size: 14px;
        }

        .object-actions {
            display: flex;
            gap: 5px;
        }

        .mini-btn {
            padding: 4px 8px;
            font-size: 12px;
            border-radius: 3px;
        }

        .status-bar {
            position: absolute;
            bottom: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            color: #ccc;
        }

        .log-container {
            position: absolute;
            top: 10px;
            right: 10px;
            width: 300px;
            max-height: 200px;
            background: rgba(0, 0, 0, 0.8);
            border-radius: 4px;
            overflow: hidden;
            display: none;
        }

        .log-header {
            background: rgba(0, 0, 0, 0.9);
            padding: 8px 12px;
            font-size: 12px;
            font-weight: bold;
            border-bottom: 1px solid #444;
        }

        .log-content {
            padding: 8px 12px;
            max-height: 150px;
            overflow-y: auto;
            font-size: 11px;
            line-height: 1.4;
        }

        .log-entry {
            margin-bottom: 4px;
            padding: 2px 0;
        }

        .log-entry.info { color: #74c0fc; }
        .log-entry.success { color: #51cf66; }
        .log-entry.warning { color: #ffd43b; }
        .log-entry.error { color: #ff6b6b; }

        .stats {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.7);
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            color: #ccc;
        }

        .stats-item {
            margin-bottom: 4px;
        }

        .stats-item:last-child {
            margin-bottom: 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="canvas-container">
            <canvas id="canvas"></canvas>
            
            <div class="stats" id="stats">
                <div class="stats-item">FPS: <span id="fps">0</span></div>
                <div class="stats-item">å¯¹è±¡: <span id="objectCount">0</span></div>
                <div class="stats-item">ç¯å…‰: <span id="lightCount">0</span></div>
                <div class="stats-item">ä¸‰è§’å½¢: <span id="triangles">0</span></div>
            </div>

            <div class="status-bar" id="status">ç­‰å¾…åˆå§‹åŒ–...</div>

            <div class="log-container" id="logContainer">
                <div class="log-header">
                    æ—¥å¿— <span class="toggle-btn" onclick="window.toggleLog()">å…³é—­</span>
                </div>
                <div class="log-content" id="logContent"></div>
            </div>
        </div>

        <div class="control-panel" id="controlPanel">
            <div class="panel-header">
                <div class="panel-title">æ§åˆ¶é¢æ¿</div>
                <button class="toggle-btn" onclick="window.togglePanel()">æ”¶èµ·</button>
            </div>
            
            <div class="panel-content">
                <!-- åœºæ™¯ç®¡ç† -->
                <div class="section"  id="scene">
                    <div class="section-header"  onclick="window.toggleSection('scene')">
                        åœºæ™¯ç®¡ç†
                        <span class="toggle-btn">å±•å¼€</span>
                    </div>
                    <div class="section-content">
                        <div class="form-group">
                            <button class="btn" onclick="window.initEngine()">åˆå§‹åŒ–å¼•æ“</button>
                            <button class="btn" onclick="window.setupBasicScene()">è®¾ç½®åŸºç¡€åœºæ™¯</button>
                        </div>
                        <div class="form-group">
                            <button class="btn" onclick="window.startRenderLoop()">å¼€å§‹æ¸²æŸ“</button>
                            <button class="btn" onclick="window.stopRenderLoop()">åœæ­¢æ¸²æŸ“</button>
                        </div>
                    </div>
                </div>

                <!-- å¯¹è±¡ç®¡ç† -->
                <div class="section"  id="objects">
                    <div class="section-header" onclick="window.toggleSection('objects')">
                        å¯¹è±¡ç®¡ç†
                        <span class="toggle-btn">å±•å¼€</span>
                    </div>
                    <div class="section-content" >
                        <div class="form-group">
                            <label>å¯¹è±¡ç±»å‹:</label>
                            <select id="objectType">
                                <option value="box">ç«‹æ–¹ä½“</option>
                                <option value="sphere">çƒä½“</option>
                                <option value="cylinder">åœ†æŸ±ä½“</option>
                                <option value="cone">åœ†é”¥ä½“</option>
                                <option value="plane">å¹³é¢</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>ä½ç½® X:</label>
                            <input type="number" id="objectX" value="0" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>ä½ç½® Y:</label>
                            <input type="number" id="objectY" value="0" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>ä½ç½® Z:</label>
                            <input type="number" id="objectZ" value="0" step="0.1">
                        </div>
                        <div class="form-group">
                            <button class="btn success" onclick="window.createObject()">åˆ›å»ºå¯¹è±¡</button>
                            <button class="btn danger" onclick="window.removeSelectedObject()">åˆ é™¤é€‰ä¸­</button>
                        </div>
                        <div class="object-list" id="objectList">
                            <!-- å¯¹è±¡åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <!-- ç¯å…‰ç®¡ç† -->
                <div class="section" id="lights">
                    <div class="section-header" onclick="window.toggleSection('lights')">
                        ç¯å…‰ç®¡ç†
                        <span class="toggle-btn">å±•å¼€</span>
                    </div>
                    <div class="section-content" >
                        <div class="form-group">
                            <label>ç¯å…‰ç±»å‹:</label>
                            <select id="lightType">
                                <option value="ambient">ç¯å¢ƒå…‰</option>
                                <option value="directional">æ–¹å‘å…‰</option>
                                <option value="point">ç‚¹å…‰æº</option>
                                <option value="spot">èšå…‰ç¯</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>å¼ºåº¦:</label>
                            <input type="number" id="lightIntensity" value="1" min="0" max="10" step="0.1">
                        </div>
                        <div class="form-group">
                            <label>é¢œè‰²:</label>
                            <input type="color" id="lightColor" value="#ffffff">
                        </div>
                        <div class="form-group">
                            <button class="btn success" onclick="window.createLight()">åˆ›å»ºç¯å…‰</button>
                            <button class="btn danger" onclick="window.removeSelectedLight()">åˆ é™¤é€‰ä¸­</button>
                        </div>
                        <div class="object-list" id="lightList">
                            <!-- ç¯å…‰åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <!-- æè´¨ç®¡ç† -->
                <div class="section" id="materials">
                    <div class="section-header" onclick="window.toggleSection('materials')">
                        æè´¨ç®¡ç†
                        <span class="toggle-btn">å±•å¼€</span>
                    </div>
                    <div class="section-content" >
                        <div class="form-group">
                            <label>æè´¨ç±»å‹:</label>
                            <select id="materialType">
                                <option value="basic">åŸºç¡€æè´¨</option>
                                <option value="phong">Phongæè´¨</option>
                                <option value="standard">æ ‡å‡†æè´¨</option>
                                <option value="physical">ç‰©ç†æè´¨</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>é¢œè‰²:</label>
                            <input type="color" id="materialColor" value="#ff0000">
                        </div>
                        <div class="form-group">
                            <label>é€æ˜åº¦:</label>
                            <input type="number" id="materialOpacity" value="1" min="0" max="1" step="0.1">
                        </div>
                        <div class="form-group">
                            <button class="btn success" onclick="window.createMaterial()">åˆ›å»ºæè´¨</button>
                            <button class="btn" onclick="window.applyMaterialToSelected()">åº”ç”¨åˆ°é€‰ä¸­å¯¹è±¡</button>
                        </div>
                        <div class="object-list" id="materialList">
                            <!-- æè´¨åˆ—è¡¨å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                        </div>
                    </div>
                </div>

                <!-- åŠ¨ç”»ç®¡ç† -->
                <div class="section" id="animations">
                    <div class="section-header" onclick="window.toggleSection('animations')">
                        åŠ¨ç”»ç®¡ç†
                        <span class="toggle-btn">å±•å¼€</span>
                    </div>
                    <div class="section-content" >
                        <div class="form-group">
                            <label>åŠ¨ç”»ç±»å‹:</label>
                            <select id="animationType">
                                <option value="rotation">æ—‹è½¬</option>
                                <option value="scale">ç¼©æ”¾</option>
                                <option value="position">ä½ç½®</option>
                                <option value="color">é¢œè‰²</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>æŒç»­æ—¶é—´(ç§’):</label>
                            <input type="number" id="animationDuration" value="2" min="0.1" max="10" step="0.1">
                        </div>
                        <div class="form-group">
                            <button class="btn success" onclick="window.createAnimation()">åˆ›å»ºåŠ¨ç”»</button>
                            <button class="btn" onclick="window.playAnimation()">æ’­æ”¾åŠ¨ç”»</button>
                            <button class="btn" onclick="window.stopAnimation()">åœæ­¢åŠ¨ç”»</button>
                        </div>
                    </div>
                </div>

                <!-- é«˜çº§åŠŸèƒ½ -->
                <div class="section" id="advanced">
                    <div class="section-header" onclick="window.toggleSection('advanced')">
                        é«˜çº§åŠŸèƒ½
                        <span class="toggle-btn">å±•å¼€</span>
                    </div>
                        <div class="section-content" >
                        <div class="form-group">
                            <button class="btn" onclick="window.createParticles()">åˆ›å»ºç²’å­</button>
                            <button class="btn" onclick="window.createShaders()">åˆ›å»ºç€è‰²å™¨</button>
                        </div>
                        <div class="form-group">
                            <button class="btn" onclick="window.createPhysics()">åˆ›å»ºç‰©ç†</button>
                            <button class="btn" onclick="window.createAudio()">åˆ›å»ºéŸ³é¢‘</button>
                        </div>
                        <div class="form-group">
                            <button class="btn" onclick="window.createPostProcessing()">åˆ›å»ºåå¤„ç†</button>
                            <button class="btn" onclick="window.toggleLog()">æ˜¾ç¤ºæ—¥å¿—</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script type="importmap">
    {
        "imports": {
            "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
            "three-core": "../dist/index.js"
        }
    }
    </script>

    <script type="module">
        import { Engine } from 'three-core';
        import * as THREE from 'three';

        let engine;
        let selectedObject = null;
        let selectedLight = null;
        let objects = new Map();
        let lights = new Map();
        let materials = new Map();
        let animations = new Map();

        // æ—¥å¿—å‡½æ•°
        function log(message, type = 'info') {
            const logContent = document.getElementById('logContent');
            if (!logContent) {
                console.log(`[${new Date().toLocaleTimeString()}] ${message}`);
                return;
            }
            
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${type}`;
            logEntry.textContent = `[${timestamp}] ${message}`;
            logContent.appendChild(logEntry);
            logContent.scrollTop = logContent.scrollHeight;
        }

        // æ›´æ–°çŠ¶æ€
        function updateStatus(message) {
            const statusElement = document.getElementById('status');
            if (statusElement) {
                statusElement.textContent = message;
            }
        }

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        function updateStats(data) {
            if (data.fps) {
                const fpsElement = document.getElementById('fps');
                if (fpsElement) fpsElement.textContent = Math.round(data.fps);
            }
            if (data.objects) {
                const objectsElement = document.getElementById('objects');
                if (objectsElement) objectsElement.textContent = data.objects;
            }
            if (data.lights) {
                const lightsElement = document.getElementById('lights');
                if (lightsElement) lightsElement.textContent = data.lights;
            }
            if (data.triangles) {
                const trianglesElement = document.getElementById('triangles');
                if (trianglesElement) trianglesElement.textContent = data.triangles.toLocaleString();
            }
        }

        // åˆ‡æ¢é¢æ¿
        window.togglePanel = function() {
            const panel = document.getElementById('controlPanel');
            panel.classList.toggle('collapsed');
        }

        // åˆ‡æ¢æ—¥å¿—
        window.toggleLog = function() {
            const logContainer = document.getElementById('logContainer');
            logContainer.style.display = logContainer.style.display === 'none' ? 'block' : 'none';
        }

        // åˆ‡æ¢åŒºåŸŸ
        window.toggleSection = function(sectionId) {
            const section = document.getElementById(sectionId);
            const content = section.querySelector('.section-content');
            const toggleBtn = section.querySelector('.toggle-btn');
            
            if (content && toggleBtn) {
                content.classList.toggle('active');
                toggleBtn.textContent = content.classList.contains('active') ? 'æ”¶èµ·' : 'å±•å¼€';
            }
        }

        // åˆå§‹åŒ–å¼•æ“
        window.initEngine = async function() {
            try {
                log('ğŸš€ å¼€å§‹åˆå§‹åŒ–å¼•æ“...', 'info');
                updateStatus('åˆå§‹åŒ–ä¸­...');

                const canvas = document.getElementById('canvas');
                const container = canvas.parentElement;

                engine = new Engine({
                    container,
                    width: container.clientWidth,
                    height: container.clientHeight,
                    antialias: true,
                    shadowMap: true,
                    autoRender: true,
                    autoResize: true,
                    enableManagers: [
                        'scene', 'renderer', 'camera', 'objects', 'lights', 
                        'controls', 'loader', 'monitor', 'materials', 'textures',
                        'animations', 'particles', 'shaders', 'physics', 'audio'
                    ]
                });

                await engine.initialize();

                log('âœ… å¼•æ“åˆå§‹åŒ–å®Œæˆ', 'success');
                updateStatus('å¼•æ“å·²åˆå§‹åŒ–');

                // è®¾ç½®äº‹ä»¶ç›‘å¬
                engine.managerAdded.subscribe((data) => {
                    if (data) {
                        log(`ğŸ“¦ ç®¡ç†å™¨å·²æ·»åŠ : ${data.name}`, 'info');
                    }
                });

                engine.engineInitialized.subscribe((engine) => {
                    if (engine) {
                        log(`âœ… å¼•æ“å·²åˆå§‹åŒ–`, 'success');
                    }
                });

            } catch (error) {
                log(`âŒ åˆå§‹åŒ–å¤±è´¥: ${error.message}`, 'error');
                updateStatus('åˆå§‹åŒ–å¤±è´¥');
            }
        };

        // è®¾ç½®åŸºç¡€åœºæ™¯
        window.setupBasicScene = async function() {
            if (!engine) {
                log('âŒ å¼•æ“æœªåˆå§‹åŒ–', 'error');
                return;
            }

            try {
                log('ğŸ¨ è®¾ç½®åŸºç¡€åœºæ™¯...', 'info');

                await engine.createManagerOnDemand('lights');
                await engine.createManagerOnDemand('objects');
                await engine.createManagerOnDemand('controls');

                const scene = engine.getManager('scene')?.getScene();
                const camera = engine.getManager('camera')?.getCamera();
                const lightsManager = await engine.getManager('lights');
                const objectsManager = await engine.getManager('objects');
                const controlsManager = await engine.getManager('controls');

                if (scene && camera) {
                    // è®¾ç½®ç›¸æœºä½ç½®
                    camera.position.set(0, 5, 10);
                    camera.lookAt(0, 0, 0);

                    // åˆ›å»ºæ§åˆ¶å™¨
                    if (controlsManager) {
                        controlsManager.createOrbitControls('orbitControls1', {
                            enableDamping: true,
                            dampingFactor: 0.05,
                            enableZoom: true,
                            enableRotate: true,
                            enablePan: true
                        });
                    }

                    // åˆ›å»ºåŸºç¡€ç¯å…‰
                    if (lightsManager) {
                        lightsManager.createAmbientLight('ambientLight', {
                            color: 0x404040,
                            intensity: 0.4
                        });
                        
                        lightsManager.createDirectionalLight('directionalLight', {
                            color: 0xffffff,
                            intensity: 1.0,
                            position: { x: 5, y: 5, z: 5 }
                        });
                    }

                    // åˆ›å»ºåŸºç¡€å¯¹è±¡
                    if (objectsManager) {
                        objectsManager.createPlane('ground', {
                            position: { x: 0, y: 0, z: 0 },
                            rotation: { x: -Math.PI / 2, y: 0, z: 0 },
                            scale: { x: 20, y: 20, z: 1 },
                            receiveShadow: true
                        });
                    }

                    log('ğŸ¨ åŸºç¡€åœºæ™¯è®¾ç½®å®Œæˆ', 'success');
                }
            } catch (error) {
                log(`âŒ è®¾ç½®åŸºç¡€åœºæ™¯å¤±è´¥: ${error.message}`, 'error');
            }
        };

        // å¼€å§‹æ¸²æŸ“å¾ªç¯
        window.startRenderLoop = function() {
            if (engine) {
                engine.startRenderLoop();
                log('ğŸ¬ æ¸²æŸ“å¾ªç¯å·²å¯åŠ¨', 'success');
                updateStatus('æ¸²æŸ“ä¸­...');
            } else {
                log('âŒ å¼•æ“æœªåˆå§‹åŒ–', 'error');
            }
        };

        // åœæ­¢æ¸²æŸ“å¾ªç¯
        window.stopRenderLoop = function() {
            if (engine) {
                engine.stopRenderLoop();
                log('â¹ï¸ æ¸²æŸ“å¾ªç¯å·²åœæ­¢', 'info');
                updateStatus('æ¸²æŸ“å·²åœæ­¢');
            } else {
                log('âŒ å¼•æ“æœªåˆå§‹åŒ–', 'error');
            }
        };

        // åˆ›å»ºå¯¹è±¡
        window.createObject = async function() {
            if (!engine) {
                log('âŒ å¼•æ“æœªåˆå§‹åŒ–', 'error');
                return;
            }

            try {
                const objectsManager = await engine.getManager('objects');
                if (!objectsManager) {
                    log('âŒ å¯¹è±¡ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                    return;
                }

                const type = document.getElementById('objectType').value;
                const x = parseFloat(document.getElementById('objectX').value);
                const y = parseFloat(document.getElementById('objectY').value);
                const z = parseFloat(document.getElementById('objectZ').value);

                const objectId = `${type}_${Date.now()}`;
                let object;

                switch (type) {
                    case 'box':
                        object = objectsManager.createBox(objectId, {
                            position: { x, y, z },
                            castShadow: true,
                            receiveShadow: true
                        });
                        break;
                    case 'sphere':
                        object = objectsManager.createSphere(objectId, {
                            position: { x, y, z },
                            radius: 1,
                            castShadow: true,
                            receiveShadow: true
                        });
                        break;
                    case 'cylinder':
                        object = objectsManager.createCylinder(objectId, {
                            position: { x, y, z },
                            radius: 1,
                            height: 2,
                            castShadow: true,
                            receiveShadow: true
                        });
                        break;
                    case 'cone':
                        object = objectsManager.createCone(objectId, {
                            position: { x, y, z },
                            radius: 1,
                            height: 2,
                            castShadow: true,
                            receiveShadow: true
                        });
                        break;
                    case 'plane':
                        object = objectsManager.createPlane(objectId, {
                            position: { x, y, z },
                            receiveShadow: true
                        });
                        break;
                }

                if (object) {
                    objects.set(objectId, {
                        object,
                        type,
                        position: { x, y, z }
                    });

                    updateObjectList();
                    log(`âœ… åˆ›å»ºäº† ${type} å¯¹è±¡: ${objectId}`, 'success');
                }
            } catch (error) {
                log(`âŒ åˆ›å»ºå¯¹è±¡å¤±è´¥: ${error.message}`, 'error');
            }
        };

        // æ›´æ–°å¯¹è±¡åˆ—è¡¨
        function updateObjectList() {
            const objectList = document.getElementById('objectList');
            objectList.innerHTML = '';

            objects.forEach((obj, id) => {
                const item = document.createElement('div');
                item.className = 'object-item';
                item.innerHTML = `
                    <span class="object-name">${obj.type}: ${id}</span>
                    <div class="object-actions">
                        <button class="btn mini-btn" onclick="window.selectObject('${id}')">é€‰æ‹©</button>
                        <button class="btn mini-btn danger" onclick="window.removeObject('${id}')">åˆ é™¤</button>
                    </div>
                `;
                objectList.appendChild(item);
            });
        }

        // é€‰æ‹©å¯¹è±¡
        window.selectObject = function(objectId) {
            selectedObject = objectId;
            log(`âœ… é€‰ä¸­å¯¹è±¡: ${objectId}`, 'info');
        };

        // åˆ é™¤å¯¹è±¡
        window.removeObject = function(objectId) {
            if (objects.has(objectId)) {
                const obj = objects.get(objectId);
                const scene = engine.getManager('scene')?.getScene();
                if (scene && obj.object) {
                    scene.remove(obj.object);
                    objects.delete(objectId);
                    updateObjectList();
                    log(`ğŸ—‘ï¸ åˆ é™¤äº†å¯¹è±¡: ${objectId}`, 'success');
                }
            }
        };

        // åˆ é™¤é€‰ä¸­çš„å¯¹è±¡
        window.removeSelectedObject = function() {
            if (selectedObject) {
                removeObject(selectedObject);
                selectedObject = null;
            } else {
                log('âš ï¸ è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå¯¹è±¡', 'warning');
            }
        };

        // åˆ›å»ºç¯å…‰
        window.createLight = async function() {
            if (!engine) {
                log('âŒ å¼•æ“æœªåˆå§‹åŒ–', 'error');
                return;
            }

            try {
                const lightsManager = await engine.getManager('lights');
                if (!lightsManager) {
                    log('âŒ ç¯å…‰ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                    return;
                }

                const type = document.getElementById('lightType').value;
                const intensity = parseFloat(document.getElementById('lightIntensity').value);
                const color = document.getElementById('lightColor').value;

                const lightId = `${type}_${Date.now()}`;
                let light;

                switch (type) {
                    case 'ambient':
                        light = lightsManager.createAmbientLight(lightId, {
                            color: parseInt(color.replace('#', '0x')),
                            intensity
                        });
                        break;
                    case 'directional':
                        light = lightsManager.createDirectionalLight(lightId, {
                            color: parseInt(color.replace('#', '0x')),
                            intensity,
                            position: { x: 5, y: 5, z: 5 }
                        });
                        break;
                    case 'point':
                        light = lightsManager.createPointLight(lightId, {
                            color: parseInt(color.replace('#', '0x')),
                            intensity,
                            position: { x: 0, y: 5, z: 0 }
                        });
                        break;
                    case 'spot':
                        light = lightsManager.createSpotLight(lightId, {
                            color: parseInt(color.replace('#', '0x')),
                            intensity,
                            position: { x: 0, y: 5, z: 0 },
                            target: { x: 0, y: 0, z: 0 }
                        });
                        break;
                }

                if (light) {
                    lights.set(lightId, {
                        light,
                        type,
                        intensity,
                        color
                    });

                    updateLightList();
                    log(`âœ… åˆ›å»ºäº† ${type} ç¯å…‰: ${lightId}`, 'success');
                }
            } catch (error) {
                log(`âŒ åˆ›å»ºç¯å…‰å¤±è´¥: ${error.message}`, 'error');
            }
        };

        // æ›´æ–°ç¯å…‰åˆ—è¡¨
        function updateLightList() {
            const lightList = document.getElementById('lightList');
            lightList.innerHTML = '';

            lights.forEach((light, id) => {
                const item = document.createElement('div');
                item.className = 'object-item';
                item.innerHTML = `
                    <span class="object-name">${light.type}: ${id}</span>
                    <div class="object-actions">
                        <button class="btn mini-btn" onclick="window.selectLight('${id}')">é€‰æ‹©</button>
                        <button class="btn mini-btn danger" onclick="window.removeLight('${id}')">åˆ é™¤</button>
                    </div>
                `;
                lightList.appendChild(item);
            });
        }

        // é€‰æ‹©ç¯å…‰
        window.selectLight = function(lightId) {
            selectedLight = lightId;
            log(`âœ… é€‰ä¸­ç¯å…‰: ${lightId}`, 'info');
        };

        // åˆ é™¤ç¯å…‰
        window.removeLight = function(lightId) {
            if (lights.has(lightId)) {
                const light = lights.get(lightId);
                const scene = engine.getManager('scene')?.getScene();
                if (scene && light.light) {
                    scene.remove(light.light);
                    lights.delete(lightId);
                    updateLightList();
                    log(`ğŸ—‘ï¸ åˆ é™¤äº†ç¯å…‰: ${lightId}`, 'success');
                }
            }
        };

        // åˆ é™¤é€‰ä¸­çš„ç¯å…‰
        window.removeSelectedLight = function() {
            if (selectedLight) {
                removeLight(selectedLight);
                selectedLight = null;
            } else {
                log('âš ï¸ è¯·å…ˆé€‰æ‹©ä¸€ä¸ªç¯å…‰', 'warning');
            }
        };

        // åˆ›å»ºæè´¨
        window.createMaterial = async function() {
            if (!engine) {
                log('âŒ å¼•æ“æœªåˆå§‹åŒ–', 'error');
                return;
            }

            try {
                const materialsManager = await engine.getManager('materials');
                if (!materialsManager) {
                    log('âŒ æè´¨ç®¡ç†å™¨æœªåˆå§‹åŒ–', 'error');
                    return;
                }

                const type = document.getElementById('materialType').value;
                const color = document.getElementById('materialColor').value;
                const opacity = parseFloat(document.getElementById('materialOpacity').value);

                const materialId = `${type}_${Date.now()}`;
                let material;

                switch (type) {
                    case 'basic':
                        material = new THREE.MeshBasicMaterial({
                            color: parseInt(color.replace('#', '0x')),
                            transparent: opacity < 1,
                            opacity
                        });
                        break;
                    case 'phong':
                        material = new THREE.MeshPhongMaterial({
                            color: parseInt(color.replace('#', '0x')),
                            transparent: opacity < 1,
                            opacity
                        });
                        break;
                    case 'standard':
                        material = new THREE.MeshStandardMaterial({
                            color: parseInt(color.replace('#', '0x')),
                            transparent: opacity < 1,
                            opacity
                        });
                        break;
                    case 'physical':
                        material = new THREE.MeshPhysicalMaterial({
                            color: parseInt(color.replace('#', '0x')),
                            transparent: opacity < 1,
                            opacity
                        });
                        break;
                }

                if (material) {
                    materialsManager.add(materialId, material);
                    materials.set(materialId, {
                        material,
                        type,
                        color,
                        opacity
                    });

                    updateMaterialList();
                    log(`âœ… åˆ›å»ºäº† ${type} æè´¨: ${materialId}`, 'success');
                }
            } catch (error) {
                log(`âŒ åˆ›å»ºæè´¨å¤±è´¥: ${error.message}`, 'error');
            }
        };

        // æ›´æ–°æè´¨åˆ—è¡¨
        function updateMaterialList() {
            const materialList = document.getElementById('materialList');
            materialList.innerHTML = '';

            materials.forEach((mat, id) => {
                const item = document.createElement('div');
                item.className = 'object-item';
                item.innerHTML = `
                    <span class="object-name">${mat.type}: ${id}</span>
                    <div class="object-actions">
                        <button class="btn mini-btn" onclick="window.selectMaterial('${id}')">é€‰æ‹©</button>
                        <button class="btn mini-btn danger" onclick="window.removeMaterial('${id}')">åˆ é™¤</button>
                    </div>
                `;
                materialList.appendChild(item);
            });
        }

        // é€‰æ‹©æè´¨
        window.selectMaterial = function(materialId) {
            log(`âœ… é€‰ä¸­æè´¨: ${materialId}`, 'info');
        };

        // åˆ é™¤æè´¨
        window.removeMaterial = function(materialId) {
            if (materials.has(materialId)) {
                materials.delete(materialId);
                updateMaterialList();
                log(`ğŸ—‘ï¸ åˆ é™¤äº†æè´¨: ${materialId}`, 'success');
            }
        };

        // åº”ç”¨æè´¨åˆ°é€‰ä¸­å¯¹è±¡
        window.applyMaterialToSelected = function() {
            if (!selectedObject || !objects.has(selectedObject)) {
                log('âš ï¸ è¯·å…ˆé€‰æ‹©ä¸€ä¸ªå¯¹è±¡', 'warning');
                return;
            }

            // è¿™é‡Œå¯ä»¥å®ç°æè´¨åº”ç”¨åˆ°å¯¹è±¡çš„é€»è¾‘
            log('ğŸ”„ æè´¨åº”ç”¨åŠŸèƒ½å¾…å®ç°', 'info');
        };

        // åˆ›å»ºåŠ¨ç”»
        window.createAnimation = function() {
            const type = document.getElementById('animationType').value;
            const duration = parseFloat(document.getElementById('animationDuration').value);
            
            log(`ğŸ¬ åˆ›å»º ${type} åŠ¨ç”»ï¼ŒæŒç»­æ—¶é—´: ${duration}ç§’`, 'info');
        };

        // æ’­æ”¾åŠ¨ç”»
        window.playAnimation = function() {
            log('â–¶ï¸ æ’­æ”¾åŠ¨ç”»', 'info');
        };

        // åœæ­¢åŠ¨ç”»
        window.stopAnimation = function() {
            log('â¹ï¸ åœæ­¢åŠ¨ç”»', 'info');
        };

        // é«˜çº§åŠŸèƒ½
        window.createParticles = async function() {
            if (!engine) {
                log('âŒ å¼•æ“æœªåˆå§‹åŒ–', 'error');
                return;
            }

            try {
                const particlesManager = await engine.getManager('particles');
                if (particlesManager) {
                    const scene = engine.getManager('scene')?.getScene();
                    if (scene) {
                        const particleSystem = particlesManager.createParticleSystem('particles', 500, {
                            size: 2,
                            color: 0x00ffff,
                            sizeAttenuation: true,
                            transparent: true,
                            opacity: 0.8,
                            blending: THREE.AdditiveBlending
                        });

                        scene.add(particleSystem.system);
                        log('âœ¨ ç²’å­ç³»ç»Ÿå·²åˆ›å»º', 'success');
                    }
                }
            } catch (error) {
                log(`âŒ åˆ›å»ºç²’å­å¤±è´¥: ${error.message}`, 'error');
            }
        };

        window.createShaders = async function() {
            if (!engine) {
                log('âŒ å¼•æ“æœªåˆå§‹åŒ–', 'error');
                return;
            }

            try {
                const scene = engine.getManager('scene')?.getScene();
                if (scene) {
                    const vertexShader = `
                        varying vec2 vUv;
                        void main() {
                            vUv = uv;
                            gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                        }
                    `;

                    const fragmentShader = `
                        uniform float time;
                        varying vec2 vUv;
                        void main() {
                            vec2 uv = vUv;
                            float wave = sin(uv.x * 10.0 + time) * 0.5 + 0.5;
                            vec3 color = mix(vec3(0.0, 0.5, 1.0), vec3(1.0, 0.0, 0.5), wave);
                            gl_FragColor = vec4(color, 1.0);
                        }
                    `;

                    const material = new THREE.ShaderMaterial({
                        uniforms: { time: { value: 0.0 } },
                        vertexShader,
                        fragmentShader
                    });

                    const geometry = new THREE.PlaneGeometry(4, 4);
                    const mesh = new THREE.Mesh(geometry, material);
                    mesh.position.set(0, 3, 0);
                    scene.add(mesh);

                    const updateShader = () => {
                        material.uniforms.time.value += 0.01;
                        requestAnimationFrame(updateShader);
                    };
                    updateShader();

                    log('ğŸ¨ è‡ªå®šä¹‰ç€è‰²å™¨å·²åˆ›å»º', 'success');
                }
            } catch (error) {
                log(`âŒ åˆ›å»ºç€è‰²å™¨å¤±è´¥: ${error.message}`, 'error');
            }
        };

        window.createPhysics = async function() {
            if (!engine) {
                log('âŒ å¼•æ“æœªåˆå§‹åŒ–', 'error');
                return;
            }

            try {
                const objectsManager = await engine.getManager('objects');
                if (objectsManager) {
                    const physicsSphere = objectsManager.createSphere('physicsSphere', {
                        position: { x: 0, y: 10, z: 0 },
                        radius: 1
                    });

                    if (physicsSphere) {
                        let velocity = new THREE.Vector3(0, 0, 0);
                        const gravity = -9.8;
                        const groundY = 0;

                        const updatePhysics = () => {
                            if (physicsSphere.position.y > groundY + 1) {
                                velocity.y += gravity * 0.016;
                                physicsSphere.position.add(velocity.clone().multiplyScalar(0.016));
                            } else {
                                physicsSphere.position.y = groundY + 1;
                                velocity.y = -velocity.y * 0.8;
                                
                                if (Math.abs(velocity.y) < 0.1) {
                                    velocity.y = 0;
                                }
                            }
                            requestAnimationFrame(updatePhysics);
                        };
                        updatePhysics();

                        log('âš¡ ç‰©ç†çƒä½“å·²åˆ›å»º', 'success');
                    }
                }
            } catch (error) {
                log(`âŒ åˆ›å»ºç‰©ç†å¤±è´¥: ${error.message}`, 'error');
            }
        };

        window.createAudio = async function() {
            if (!engine) {
                log('âŒ å¼•æ“æœªåˆå§‹åŒ–', 'error');
                return;
            }

            try {
                const audioManager = await engine.getManager('audio');
                if (audioManager) {
                    const camera = engine.getManager('camera')?.getCamera();
                    if (camera) {
                        camera.add(audioManager.listener);
                        log('ğŸ”Š éŸ³é¢‘ç³»ç»Ÿå·²åˆå§‹åŒ–', 'success');
                    }
                }
            } catch (error) {
                log(`âŒ åˆ›å»ºéŸ³é¢‘å¤±è´¥: ${error.message}`, 'error');
            }
        };

        window.createPostProcessing = async function() {
            if (!engine) {
                log('âŒ å¼•æ“æœªåˆå§‹åŒ–', 'error');
                return;
            }

            try {
                const composerManager = await engine.getManager('composer');
                if (composerManager) {
                    log('ğŸ¨ åå¤„ç†ç³»ç»Ÿå·²åˆå§‹åŒ–', 'success');
                }
            } catch (error) {
                log(`âŒ åˆ›å»ºåå¤„ç†å¤±è´¥: ${error.message}`, 'error');
            }
        };

        // åˆå§‹åŒ–é¡µé¢
        log('ğŸ“‹ Three-Core å¼•æ“æ¼”ç¤ºå·²åŠ è½½', 'info');
        log('ğŸ’¡ åŠŸèƒ½è¯´æ˜:', 'info');
        log('   - æ”¯æŒå¯¹è±¡ã€ç¯å…‰ã€æè´¨çš„åˆ›å»ºå’Œåˆ é™¤', 'info');
        log('   - å®æ—¶å±æ€§ä¿®æ”¹å’Œåœºæ™¯äº¤äº’', 'info');
        log('   - é¢æ¿å¯æ”¶èµ·ï¼Œæ—¥å¿—å¯åˆ‡æ¢æ˜¾ç¤º', 'info');
    </script>
</body>
</html> 